@if (passwordResetSuccess) {

<!-- Success modal -->
<app-auth-success-modal
  title="Password Reset Complete"
  [message]="
    'Your password has been successfully reset.<br />You can now log in to your account.'
  "
></app-auth-success-modal>

} @else {

<div class="password-reset-confirm">
  <div class="headline">Enter New Password</div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- Password field -->
    <div class="input-field">
      <label
        [for]="FIELD.password"
        [ngClass]="getFieldInputClasses(FIELD.password)"
      >
        {{ LABEL.password }}
      </label>

      <input
        [formControlName]="FIELD.password"
        type="password"
        [id]="FIELD.password"
        [name]="FIELD.password"
        autocomplete="new-password"
        (focus)="fieldFocusStates[FIELD.password] = true"
        (blur)="fieldFocusStates[FIELD.password] = false"
        [ngClass]="getFieldInputClasses(FIELD.password)"
        [attr.aria-describedby]="getAriaDescribedBy(FIELD.password)"
        required
      />

      <!-- Static password icon -->
      <img
        class="icon icon--base"
        src="./assets/img/form/password.svg"
        alt="password icon"
        [ngClass]="getFieldInputClasses(FIELD.password)"
      />

      <!-- Validation status icon -->
      @if (getStatusIcon(FIELD.password) === 'success') {
      <img
        class="icon icon--status"
        src="./assets/img/form/success.svg"
        alt="valid input"
      />
      } @else if (getStatusIcon(FIELD.password) === 'error') {
      <img
        class="icon icon--status"
        src="./assets/img/form/error.svg"
        alt="invalid input"
      />
      }
    </div>

    <!-- Frontend password error message -->
    <div
      class="error-wrapper"
      [ngClass]="{ visible: getFormErrors(FIELD.password).length > 0 }"
      [id]="FIELD.password + '-errors'"
      role="alert"
      aria-live="assertive"
    >
      <div class="error-message">
        @if (getFormErrors(FIELD.password)[0]; as error) {
        <p>{{ error }}</p>
        }
      </div>
    </div>

    <!-- Confirm password field -->
    <div class="input-field">
      <label
        [for]="FIELD.confirmPassword"
        [ngClass]="getFieldInputClasses(FIELD.confirmPassword)"
      >
        {{ LABEL.confirmPassword }}
      </label>

      <input
        [formControlName]="FIELD.confirmPassword"
        type="password"
        [id]="FIELD.confirmPassword"
        [name]="FIELD.confirmPassword"
        autocomplete="new-password"
        (focus)="fieldFocusStates[FIELD.confirmPassword] = true"
        (blur)="fieldFocusStates[FIELD.confirmPassword] = false"
        [ngClass]="getFieldInputClasses(FIELD.confirmPassword)"
        [attr.aria-describedby]="getAriaDescribedBy(FIELD.confirmPassword)"
        required
      />

      <!-- Static confirm password icon -->
      <img
        class="icon icon--base"
        src="./assets/img/form/password.svg"
        alt="password icon"
        [ngClass]="getFieldInputClasses(FIELD.confirmPassword)"
      />

      <!-- Validation status icon -->
      @if (getStatusIcon(FIELD.confirmPassword) === 'success') {
      <img
        class="icon icon--status"
        src="./assets/img/form/success.svg"
        alt="valid input"
      />
      } @else if (getStatusIcon(FIELD.confirmPassword) === 'error') {
      <img
        class="icon icon--status"
        src="./assets/img/form/error.svg"
        alt="invalid input"
      />
      }
    </div>

    <!-- Combined Error Message for Frontend + Backend -->
    <div
      class="error-wrapper"
      [ngClass]="{
        visible:
          getFormErrors(FIELD.confirmPassword).length > 0 || httpErrorMessage
      }"
      [id]="FIELD.confirmPassword + '-errors'"
      role="alert"
      aria-live="assertive"
    >
      <div class="error-message">
        <!-- Frontend Confirm Password Error Message -->
        @if (getFormErrors(FIELD.confirmPassword)[0]; as error) {
        <p>{{ error }}</p>
        }

        <!-- Backend Global Error Message -->
        @else if (httpErrorMessage) {
        <p class="backend-error" [innerHTML]="httpErrorMessage"></p>
        }
      </div>
    </div>

    <!-- Register button -->
    <div class="button-container">
      <app-primary-button
        type="submit"
        value="Send new password"
        [loading]="isUpdatingPassword"
        [loadingMessage]="'Password is being updated...'"
        [disabled]="isButtonDisabled"
      >
      </app-primary-button>
    </div>
  </form>
</div>
}
